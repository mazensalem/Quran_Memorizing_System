@page
@model Quran_Memorizing_System.Pages.ExamsModel
@{
}
@section Styles {
    <link rel="stylesheet" href="~/css/Exam.css" asp-append-version="true" />
}

<form method="post" class="row pt-3 container">
    <h2>@Model.Exam.Rows[0]["Title"]</h2>
    <!-- Questions -->
    <div class="col-lg-8">
        @for (var i = 0; i < Model.Questions.Count; i++)
        {
            var q = Model.Questions[i];
            <section class="mb-4">
                <div class="question-title">@q.Title</div>
                <div class="question-divider"></div>

                <div class="question-box">
                    <input type="hidden" asp-for="Questions[@i].Id" />
                    <input type="hidden" asp-for="Questions[@i].ExamId" />
                    <input type="hidden" asp-for="Questions[@i].Title" />
                    <input type="hidden" asp-for="Questions[@i].Type" />
                    <input type="hidden" asp-for="subid" />
                    @if (q.Choices != null && q.Choices.Count > 0)
                    {
                        var choiceIndex = 0;

                        foreach (var choice in q.Choices)
                        {
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="Questions[@i].CorrectAnswerText" value="@choice.Text" id="q@(i)_choice@(choiceIndex)" />
                                <label class="form-check-label" for="q@(i)_choice@(choiceIndex)">@choice.Text</label>
                            </div>
                            choiceIndex++;
                        }
                    }
                    else
                    {
                        <div class="mb-3">
                            <label for="q@(i + 1)text" class="form-label visually-hidden">Question @(i + 1) answer</label>
                            <textarea class="form-control border-0"
                              id="q@(i + 1)text"
                              name="q@(i + 1)"
                              rows="5"
                              placeholder="Enter the answer"></textarea>
                        </div>
                    }
                </div>
            </section>
        }

        <!-- Submit button -->
        <button type="submit" class="btn btn-dark px-4">
            Submit
        </button>
    </div>

    <!-- Timer column -->
    <div class="col-lg-4 d-flex justify-content-lg-end justify-content-center align-content-lg-start align-items-start mt-4 mt-lg-0">
        <div class="timer-card">
            <div class="timer-title">Timer Left</div>
            <div class="timer-time" id="timer">00:00</div>
        </div>
    </div>

</form>


@section Scripts {
    <script>
        let timeLeft = @Model.lefttime * 60;
        const timerElement = document.getElementById('timer');

        const countdown = setInterval(() => {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            if (timeLeft <= 0) {
                clearInterval(countdown);
                timerElement.textContent = 'Time up!';
                document.querySelector('button[type="submit"]').click();
            }
            timeLeft--;
        }, 1000);
    </script>
}